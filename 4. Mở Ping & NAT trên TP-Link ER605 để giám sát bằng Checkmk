# HÆ°á»›ng dáº«n má»Ÿ Ping & NAT trÃªn TP-Link ER605 Ä‘á»ƒ giÃ¡m sÃ¡t báº±ng Checkmk

## 1. Kiá»ƒm tra IP vÃ  phÃ¢n biá»‡t WAN / LAN
- **LAN IP**: `192.168.8.1` â†’ ping trong LAN OK.
- **WAN IP**: `222.252.10.125` â†’ lÃ  IP Public, Checkmk Ä‘ang dÃ¹ng Ä‘á»ƒ test nhÆ°ng bá»‹ timeout.

ğŸ‘‰ Náº¿u Checkmk server náº±m trong LAN â†’ dÃ¹ng LAN IP (192.168.8.1).  
ğŸ‘‰ Náº¿u Checkmk server á»Ÿ ngoÃ i Internet â†’ cáº§n má»Ÿ ping & dá»‹ch vá»¥ qua WAN IP.

---

## 2. NguyÃªn nhÃ¢n ping WAN IP tháº¥t báº¡i
- Máº·c Ä‘á»‹nh router **cháº·n ICMP tá»« WAN**.
- Trong cáº¥u hÃ¬nh **Packet Anomaly Defense** cÃ³ tick má»¥c **Block Ping from WAN**.
- Do Ä‘Ã³, Checkmk ping `222.252.10.125` luÃ´n 100% loss.

---

## 3. Má»Ÿ Ping tá»« WAN
1. ÄÄƒng nháº­p router qua `192.168.8.1`.
2. VÃ o **Firewall â†’ Attack Defense**.
3. **Bá» chá»n** má»¥c **Block Ping from WAN**.
4. Save & Apply.
5. Kiá»ƒm tra láº¡i báº±ng lá»‡nh:
   ```bash
   ping 222.252.10.125
   ```

---

## 4. Má»Ÿ Port cho SNMP hoáº·c Checkmk Agent (NAT)
Náº¿u muá»‘n Checkmk monitor chi tiáº¿t báº±ng **SNMP (161/UDP)** hoáº·c **Agent (6556/TCP)**:

1. VÃ o **Transmission â†’ NAT â†’ Virtual Server**.
2. Báº¥m **Add**, Ä‘iá»n nhÆ° sau:

### VÃ­ dá»¥ SNMP (161/UDP)
- Name: `SNMP`
- Interface: `WAN`
- WAN IP: Ä‘á»ƒ trá»‘ng hoáº·c chá»n `222.252.10.125`
- External Port: `161`
- Internal Port: `161`
- Internal Server IP: `192.168.8.1`
- Protocol: `UDP`
- Status: `Enable`

### VÃ­ dá»¥ Checkmk Agent (6556/TCP)
- Name: `Checkmk-Agent`
- Interface: `WAN`
- WAN IP: `222.252.10.125`
- External Port: `6556`
- Internal Port: `6556`
- Internal Server IP: `192.168.8.1`
- Protocol: `TCP`
- Status: `Enable`

3. Save & Apply.

---

## 5. Kiá»ƒm tra tá»« Checkmk server
- Test ping:
  ```bash
  ping 222.252.10.125
  ```
- Test SNMP:
  ```bash
  snmpwalk -v2c -c public 222.252.10.125
  ```
- Test Checkmk Agent:
  ```bash
  telnet 222.252.10.125 6556
  ```

---

## 6. Báº£o máº­t
- Khi má»Ÿ ping/port ra ngoÃ i, toÃ n Internet Ä‘á»u cÃ³ thá»ƒ scan tháº¥y.
- Khuyáº¿n nghá»‹:
  - Táº¡o **Access Control (ACL)** chá»‰ cho phÃ©p IP Checkmk server.
  - Hoáº·c triá»ƒn khai **VPN** Ä‘á»ƒ Checkmk giÃ¡m sÃ¡t LAN IP (192.168.8.1).
- Chá»‰ nÃªn má»Ÿ cÃ¡c dá»‹ch vá»¥ thá»±c sá»± cáº§n thiáº¿t.

---

## 7. Káº¿t luáº­n
- Náº¿u chá»‰ cáº§n biáº¿t router cÃ³ hoáº¡t Ä‘á»™ng hay khÃ´ng â†’ má»Ÿ **Respond to Ping on WAN**.
- Náº¿u cáº§n monitor sÃ¢u (CPU, RAM, traffic) â†’ má»Ÿ **SNMP** hoáº·c **Checkmk Agent** qua NAT.
- LuÃ´n káº¿t há»£p vá»›i **ACL** Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n.
